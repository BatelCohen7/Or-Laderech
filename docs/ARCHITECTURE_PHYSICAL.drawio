<mxfile host="app.diagrams.net" modified="2024-01-01T00:00:00.000Z" agent="5.0" version="21.0.0" etag="drawio" type="device">
  <diagram id="system-context" name="1. C4 Level 1 - System Context">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1169" pageHeight="827" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="resident" value="Resident User&#xa;~200 users&#xa;Role: resident" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="committee" value="Committee Member&#xa;~5-10 users&#xa;Role: committee" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="40" y="320" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="admin" value="Admin Root&#xa;1-3 users&#xa;Role: admin_root" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="40" y="440" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="system" value="Or LaDerech&#xa;Urban Renewal Platform&#xa;Single Project Mode" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#4a90e2;strokeColor=#2980b9;fontColor=#ffffff;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="280" width="300" height="120" as="geometry" />
        </mxCell>
        <mxCell id="edge1" value="HTTPS&#xa;JWT Auth&#xa;/api/v1/*" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#2c3e50;" edge="1" parent="1" source="resident" target="system">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="edge2" value="HTTPS&#xa;JWT Auth&#xa;/api/v1/*" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#2c3e50;" edge="1" parent="1" source="committee" target="system">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="edge3" value="HTTPS&#xa;JWT Auth&#xa;/api/v1/*" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#2c3e50;" edge="1" parent="1" source="admin" target="system">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title1" value="C4 Level 1 - System Context" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="40" width="300" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="containers" name="2. C4 Level 2 - Containers">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="user" value="Users&#xa;Resident/Committee/Admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ecf0f1;strokeColor=#bdc3c7;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="web" value="Web Application&#xa;Future: React/Vue" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="280" y="40" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mobile" value="Mobile App&#xa;Future: React Native" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e8f5e9;strokeColor=#4caf50;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="500" y="40" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="api" value="NestJS Backend&#xa;Port: 3000&#xa;Prefix: /api/v1&#xa;JWT Auth Boundary" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="280" y="200" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="db" value="PostgreSQL Database&#xa;RLS Enabled&#xa;Triggers Active&#xa;Trust Boundary" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#2c3e50;strokeColor=#34495e;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="280" y="400" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="local" value="Local File Storage&#xa;Path: ./storage&#xa;Token Download" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f39c12;strokeColor=#e67e22;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="560" y="400" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="s3" value="S3 Storage&#xa;Future: Presigned URLs&#xa;No Token Validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e67e22;strokeColor=#d35400;fontColor=#ffffff;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="500" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="memq" value="In-Memory Queue&#xa;Current Implementation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="800" y="400" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="redisq" value="Redis/Bull Queue&#xa;Future Implementation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#c0392b;strokeColor=#a93226;fontColor=#ffffff;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="800" y="500" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="audit" value="Audit Events&#xa;audit_events table" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1040" y="400" width="180" height="100" as="geometry" />
        </mxCell>
        <mxCell id="logs" value="Application Logs&#xa;Structured Logging" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1040" y="520" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="e1" value="HTTPS" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="user" target="web">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2" value="HTTPS" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="user" target="mobile">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e3" value="HTTPS&#xa;JWT" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#e74c3c;" edge="1" parent="1" source="web" target="api">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" value="HTTPS&#xa;JWT" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#e74c3c;" edge="1" parent="1" source="mobile" target="api">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" value="Prisma ORM&#xa;Session Vars&#xa;RLS Context" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#2c3e50;" edge="1" parent="1" source="api" target="db">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" value="File I/O&#xa;Token Validation" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="api" target="local">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" value="Presigned URLs&#xa;Direct Access" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;dashed=1;" edge="1" parent="1" source="api" target="s3">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e8" value="Schedule Jobs" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="api" target="memq">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e9" value="Schedule Jobs" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;dashed=1;" edge="1" parent="1" source="api" target="redisq">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e10" value="Write Events" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="api" target="audit">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e11" value="Write Logs" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="api" target="logs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title2" value="C4 Level 2 - Containers" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="560" y="680" width="300" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="components" name="3. C4 Level 3 - Backend Components">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="appmod" value="AppModule&#xa;Root Application&#xa;Provides: PrismaService&#xa;Global: ThrottlerGuard" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;fontSize=12;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="600" y="40" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="config" value="ConfigModule&#xa;ConfigService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="200" y="200" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="auditmod" value="AuditModule&#xa;AuditService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="400" y="200" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="storage" value="StorageModule&#xa;@Global&#xa;StorageService&#xa;DownloadTokenService&#xa;StorageController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ecc71;strokeColor=#27ae60;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="200" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="jobs" value="JobQueueModule&#xa;@Global&#xa;JobQueueService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f39c12;strokeColor=#e67e22;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="850" y="200" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="health" value="HealthModule&#xa;HealthController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="1050" y="200" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="auth" value="AuthModule&#xa;AuthController&#xa;AuthService&#xa;/api/v1/auth/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e67e22;strokeColor=#d35400;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="200" y="350" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="projects" value="ProjectsModule&#xa;ProjectsController&#xa;ProjectsService&#xa;/api/v1/projects/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#16a085;strokeColor=#138d75;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="420" y="350" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="docs" value="DocumentsModule&#xa;DocumentsController&#xa;DocumentsService&#xa;/api/v1/projects/:id/documents/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="640" y="350" width="220" height="80" as="geometry" />
        </mxCell>
        <mxCell id="votes" value="VotesModule&#xa;VotesController&#xa;VotesService&#xa;/api/v1/projects/:id/votes/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="350" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="messages" value="MessagesModule&#xa;MessagesController&#xa;MessagesService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="200" y="480" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="logsmod" value="ProjectLogsModule&#xa;ProjectLogsController" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="420" y="480" width="180" height="60" as="geometry" />
        </mxCell>
        <mxCell id="admin" value="AdminModule&#xa;AdminController&#xa;AdminService&#xa;ApartmentsService&#xa;/api/v1/admin/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#34495e;strokeColor=#2c3e50;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="640" y="480" width="180" height="80" as="geometry" />
        </mxCell>
        <mxCell id="appme" value="AppModule&#xa;app/app.module.ts&#xa;MeController&#xa;MeDocumentsController&#xa;MeVotesController&#xa;/api/v1/me/*" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#16a085;strokeColor=#138d75;fontColor=#ffffff;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="860" y="480" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="guards" value="Guards &amp; Middleware&#xa;JwtAuthGuard&#xa;PermissionsGuard&#xa;ProjectMembershipGuard" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f39c12;strokeColor=#e67e22;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="200" y="620" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="e1" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="appmod" target="config">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="appmod" target="auditmod">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="appmod" target="storage">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="appmod" target="jobs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="docs" target="storage">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="docs" target="auditmod">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="votes" target="auditmod">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e8" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="votes" target="jobs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e9" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="appme" target="docs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e10" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="appme" target="votes">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title3" value="C4 Level 3 - Backend Components" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="500" y="750" width="400" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="database" name="4. Database Physical ERD">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="user" value="users&#xa;RLS: N/A&#xa;PK: id&#xa;UK: email" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ecf0f1;strokeColor=#bdc3c7;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="role" value="roles&#xa;RLS: N/A&#xa;PK: id&#xa;UK: name" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ecf0f1;strokeColor=#bdc3c7;" vertex="1" parent="1">
          <mxGeometry x="40" y="160" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="perm" value="permissions&#xa;RLS: N/A&#xa;PK: id&#xa;UK: key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ecf0f1;strokeColor=#bdc3c7;" vertex="1" parent="1">
          <mxGeometry x="40" y="280" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="project" value="projects&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: created_by" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="320" y="40" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="pm" value="project_memberships&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, user_id, role_id&#xa;UK: (project_id, user_id)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="320" y="160" width="220" height="100" as="geometry" />
        </mxCell>
        <mxCell id="apt" value="apartments&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id&#xa;UK: (id, project_id)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="320" y="300" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="aptu" value="apartment_users&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, apartment_id, user_id&#xa;UK: (apartment_id, user_id)&#xa;Trigger: max_2_users" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="320" y="440" width="220" height="120" as="geometry" />
        </mxCell>
        <mxCell id="doc" value="documents&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, created_by_user_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="40" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="docass" value="document_assignments&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, document_id, resident_user_id&#xa;UK: (document_id, resident_user_id)&#xa;Trigger: immutable_signed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="160" width="240" height="120" as="geometry" />
        </mxCell>
        <mxCell id="vote" value="votes&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, created_by_user_id&#xa;Time Rule: now &lt; closes_at" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="320" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="voteopt" value="vote_options&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: vote_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="460" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ballot" value="vote_ballots&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, vote_id, voter_user_id, option_id&#xa;UK: (vote_id, voter_user_id)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="600" y="580" width="220" height="100" as="geometry" />
        </mxCell>
        <mxCell id="msg" value="messages&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, created_by_user_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="40" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="log" value="project_logs&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: project_id, created_by_user_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="160" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="audit" value="audit_events&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: actor_user_id, project_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="280" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="imp" value="impersonation_sessions&#xa;RLS: Enabled&#xa;PK: id&#xa;FK: admin_user_id, impersonated_user_id" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="900" y="400" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ff" value="feature_flags&#xa;RLS: N/A&#xa;PK: id&#xa;UK: key" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#ecf0f1;strokeColor=#bdc3c7;" vertex="1" parent="1">
          <mxGeometry x="900" y="520" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="e1" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="user" target="pm">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="role" target="pm">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="project" target="pm">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="project" target="apt">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="apt" target="aptu">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="user" target="aptu">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="project" target="doc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e8" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="doc" target="docass">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e9" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="user" target="docass">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e10" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="project" target="vote">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e11" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="vote" target="voteopt">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e12" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="vote" target="ballot">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e13" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="user" target="ballot">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title4" value="Database Physical ERD - RLS Enabled Tables (Blue), Triggers (Red), System Tables (Purple)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="750" width="600" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="docflow" name="5.1 Document Flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="c" value="Committee/Admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dc" value="DocumentsController&#xa;POST /api/v1/projects/:id/documents" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ecc71;strokeColor=#27ae60;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="40" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ds" value="DocumentsService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f39c12;strokeColor=#e67e22;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="140" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ss" value="StorageService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e67e22;strokeColor=#d35400;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="240" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="ps" value="PrismaService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="340" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="db" value="PostgreSQL&#xa;RLS: committee/admin only" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#2c3e50;strokeColor=#34495e;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="440" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="as" value="AuditService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="560" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="r" value="Resident" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="520" y="40" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mdc" value="MeDocumentsController&#xa;GET /api/v1/me/documents/:id/download" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ecc71;strokeColor=#27ae60;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="720" y="40" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dts" value="DownloadTokenService&#xa;Secret: DOWNLOAD_JWT_SECRET&#xa;TTL: 10m default" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="720" y="140" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="sc" value="StorageController&#xa;GET /api/v1/storage/download?token=...&#xa;Public: No JWT Required" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#16a085;strokeColor=#138d75;fontColor=#ffffff;strokeWidth=3;" vertex="1" parent="1">
          <mxGeometry x="720" y="260" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="fs" value="File System&#xa;./storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#34495e;strokeColor=#2c3e50;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="720" y="400" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="e1" value="1. Upload" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="c" target="dc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="dc" target="ds">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="ds" target="ss">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="ds" target="ps">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="ps" target="db">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" value="2. Download Request" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="r" target="mdc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="mdc" target="dts">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e8" value="3. Download File" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#e74c3c;strokeWidth=3;" edge="1" parent="1" source="r" target="sc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e9" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="sc" target="fs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title5" value="5.1 Document Flow - Upload, Assign, Download, Sign" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="520" width="400" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="voteflow" name="5.2 Voting Flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="c" value="Committee/Admin" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#3498db;strokeColor=#2980b9;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="40" y="40" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="vc" value="VotesController&#xa;POST /api/v1/projects/:id/votes" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ecc71;strokeColor=#27ae60;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="40" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="vs" value="VotesService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f39c12;strokeColor=#e67e22;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="140" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="jq" value="JobQueueService&#xa;Schedule reminder&#xa;24h before closesAt" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="240" width="200" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ps" value="PrismaService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="360" width="200" height="60" as="geometry" />
        </mxCell>
        <mxCell id="db" value="PostgreSQL&#xa;Time Rule: now &lt; closes_at&#xa;UK: (vote_id, voter_user_id)" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fillColor=#2c3e50;strokeColor=#34495e;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="460" width="200" height="100" as="geometry" />
        </mxCell>
        <mxCell id="r" value="Resident" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="520" y="40" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mvc" value="MeVotesController&#xa;POST /api/v1/me/votes/:id/ballot" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ecc71;strokeColor=#27ae60;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="720" y="40" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="as" value="AuditService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="720" y="140" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="e1" value="1. Create Vote" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="c" target="vc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="vc" target="vs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="vs" target="jq">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="vs" target="ps">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="ps" target="db">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" value="2. Vote" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="r" target="mvc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="mvc" target="vs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e8" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="vs" target="as">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title6" value="5.2 Voting Flow - Create, Vote, Results (Idempotent, Time Validated)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="620" width="500" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="tokenflow" name="5.3 Download Token Validation Flow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="r" value="Resident" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#95a5a6;strokeColor=#7f8c8d;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="40" y="200" width="150" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mdc" value="MeDocumentsController&#xa;GET /api/v1/me/documents/:id/download&#xa;JWT Auth Required" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#2ecc71;strokeColor=#27ae60;fontColor=#ffffff;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="240" y="200" width="240" height="80" as="geometry" />
        </mxCell>
        <mxCell id="ds" value="DocumentsService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f39c12;strokeColor=#e67e22;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="320" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="dts" value="DownloadTokenService&#xa;generateToken()&#xa;Secret: DOWNLOAD_JWT_SECRET&#xa;TTL: 10m (600s)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="420" width="240" height="100" as="geometry" />
        </mxCell>
        <mxCell id="jwt" value="JWT Service&#xa;sign(payload, secret)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#9b59b6;strokeColor=#8e44ad;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="240" y="560" width="240" height="60" as="geometry" />
        </mxCell>
        <mxCell id="sc" value="StorageController&#xa;GET /api/v1/storage/download?token=...&#xa;PUBLIC: No JWT Required&#xa;Token Validation Only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#16a085;strokeColor=#138d75;fontColor=#ffffff;strokeWidth=4;dashed=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="200" width="280" height="120" as="geometry" />
        </mxCell>
        <mxCell id="dts2" value="DownloadTokenService&#xa;validateToken()&#xa;verify(token, DOWNLOAD_JWT_SECRET)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e74c3c;strokeColor=#c0392b;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="560" y="360" width="280" height="100" as="geometry" />
        </mxCell>
        <mxCell id="ss" value="StorageService&#xa;Read file from ./storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e67e22;strokeColor=#d35400;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="560" y="500" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="fs" value="File System&#xa;./storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#34495e;strokeColor=#2c3e50;fontColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="560" y="600" width="280" height="60" as="geometry" />
        </mxCell>
        <mxCell id="e1" value="1. Request Download URL&#xa;JWT Bearer Token" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#e74c3c;strokeWidth=3;" edge="1" parent="1" source="r" target="mdc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e2" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="mdc" target="ds">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e3" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="ds" target="dts">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e4" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="dts" target="jwt">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e5" value="2. Download File&#xa;NO JWT Required" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;strokeColor=#16a085;strokeWidth=4;dashed=1;" edge="1" parent="1" source="r" target="sc">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e6" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="sc" target="dts2">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e7" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="dts2" target="jwt">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e8" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="sc" target="ss">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="e9" style="endArrow=classic;html=1;rounded=0;strokeWidth=2;" edge="1" parent="1" source="ss" target="fs">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="500" y="400" as="sourcePoint" />
            <mxPoint x="550" y="350" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="title7" value="5.3 Download Token Validation Flow - JWT Auth Boundary vs Public Token Validation" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="300" y="720" width="600" height="30" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
